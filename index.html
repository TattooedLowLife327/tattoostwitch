<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
<meta http-equiv="Pragma" content="no-cache" />
<meta http-equiv="Expires" content="0" />
<meta name="theme-color" content="#8B5CF6" />
<link rel="manifest" href="manifest.json" />
<link rel="apple-touch-icon" href="images/apple-touch-icon.png" />
<link rel="icon" type="image/png" sizes="32x32" href="images/favicon-32x32.png" />
<link rel="icon" type="image/png" sizes="16x16" href="images/favicon-16x16.png" />
<link rel="stylesheet" href="css/styles.css" />
<title>Tattoo's Twitch Controls</title>
</head>
<body>

<!-- Login Screen -->
<div id="login-screen" class="container">
  <div class="login-form">
    <img src="images/bannerphoto.png" alt="Tattoo's Twitch Banner" style="width: 100%; max-width: 500px; margin-bottom: 20px;">
    <input type="password" id="pin-input" placeholder="Enter PIN" autocomplete="off" inputmode="numeric" />
    <button class="btn" onclick="login()">Login</button>
    <div id="login-error" class="error hidden"></div>
  </div>
</div>

<!-- PIN Pad Overlay -->
<div id="pin-pad-overlay" class="pin-pad-overlay" onclick="handlePadBackgroundClick(event)">
  <div class="pin-pad" role="dialog" aria-modal="true" aria-label="PIN pad">
    <button class="pin-pad-close" onclick="hidePinPad()" aria-label="Close PIN pad"></button>
    <h3>Enter PIN</h3>
    <div class="pin-pad-display" id="pin-pad-display">‚Ä¢‚Ä¢‚Ä¢‚Ä¢</div>
    <div class="pin-pad-grid">
      <button class="pin-btn digit-1" onclick="appendPinDigit('1')" aria-label="1">1</button>
      <button class="pin-btn digit-2" onclick="appendPinDigit('2')" aria-label="2">2</button>
      <button class="pin-btn digit-3" onclick="appendPinDigit('3')" aria-label="3">3</button>
      <button class="pin-btn digit-4" onclick="appendPinDigit('4')" aria-label="4">4</button>
      <button class="pin-btn digit-5" onclick="appendPinDigit('5')" aria-label="5">5</button>
      <button class="pin-btn digit-6" onclick="appendPinDigit('6')" aria-label="6">6</button>
      <button class="pin-btn digit-7" onclick="appendPinDigit('7')" aria-label="7">7</button>
      <button class="pin-btn digit-8" onclick="appendPinDigit('8')" aria-label="8">8</button>
      <button class="pin-btn digit-9" onclick="appendPinDigit('9')" aria-label="9">9</button>
      <button class="pin-btn clear-btn" onclick="clearPin()" aria-label="Clear">C</button>
      <button class="pin-btn digit-0" onclick="appendPinDigit('0')" aria-label="0">0</button>
      <button class="pin-btn back-btn" onclick="backspacePinDigit()" aria-label="Backspace">Back</button>
    </div>
    <div class="pin-pad-actions">
      <button class="submit-btn" onclick="submitPinPad()" aria-label="Submit PIN">Submit</button>
    </div>
  </div>
</div>

<!-- Admin Screen -->
<div id="admin-screen" class="container hidden">
  <img src="images/bannerphoto.png" alt="Tattoo's Twitch Banner" style="width: 100%; max-width: 600px; margin: 0 auto 20px; display: block;">

  <!-- Tab Navigation -->
  <div class="tabs">
    <div style="display: flex; gap: 10px; flex: 1; overflow-x: auto;">
      <button class="tab-button active" data-tab="dashboard">Dashboard</button>
      <button class="tab-button" data-tab="music">Music</button>
      <button class="tab-button" data-tab="overlays">Overlays</button>
      <button class="tab-button" data-tab="settings">Settings</button>
      <button class="tab-button" data-tab="help">Help</button>
    </div>
    <div id="connection-indicator" class="connection-indicator">
      <div class="connection-dot disconnected"></div>
      <button id="restart-bot-btn" class="restart-bot-btn hidden" onclick="restartBot()">Restart Bot</button>
    </div>
  </div>

  <!-- Dashboard Tab -->
  <div id="tab-dashboard" class="tab-content active">
    <!-- Admin Check-In Section (only for non-owner admins) -->
    <div id="admin-checkin-section" class="section hidden">
      <h2>Admin Status</h2>
      <div style="text-align: center; padding: 15px; background: rgba(139, 92, 246, 0.1); border-radius: 8px; margin-bottom: 10px;">
        <div style="font-size: 18px; font-weight: 600; color: var(--purple);">
          Status: <span id="my-checkin-status">Not Checked In</span>
        </div>
        <div id="my-checkin-time" style="color: var(--muted); font-size: 14px; margin-top: 5px;"></div>
      </div>
      <div id="checkin-btn-container">
        <button class="btn" style="background: #10b981;" onclick="checkIn()">Check In</button>
      </div>
      <div id="checkout-btn-container" class="hidden">
        <button class="btn" style="background: #ff9800;" onclick="checkOut()">Check Out</button>
      </div>
    </div>

    <!-- Active Admin Section (only shown to owner when non-owner admin is checked in) -->
    <div id="active-admin-section" class="section hidden">
      <h2>Checked-In Admin</h2>
      <div id="admin-status" style="text-align: center; padding: 15px; background: rgba(139, 92, 246, 0.1); border-radius: 8px; margin-bottom: 10px;">
        <div style="font-size: 18px; font-weight: 600; color: var(--purple);">
          <span id="current-admin-name"></span>
        </div>
        <div id="admin-since" style="color: var(--muted); font-size: 14px; margin-top: 5px;"></div>
      </div>
      <button class="btn" style="background: #ff6b6b;" onclick="bootAdmin()">Boot Admin</button>
    </div>

    <div class="grid-2">
      <!-- Now Playing -->
      <div class="section">
        <h2>Now Playing</h2>
        <div class="spotify-player">
          <div class="player-layout">
            <div class="album-art-container">
              <div class="album-glow"></div>
              <div class="album-art" id="album-art">
                <svg viewBox="0 0 24 24" fill="white" style="width: 64px; height: 64px;">
                  <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 14.5v-9l6 4.5-6 4.5z"/>
                </svg>
              </div>
              <div class="music-notes" id="music-notes">
                <div class="music-note">‚ô™</div>
                <div class="music-note">‚ô´</div>
                <div class="music-note">‚ô™</div>
              </div>
            </div>
            <div class="player-info">
              <div class="track-title" id="track-title">‚Äî</div>
              <div class="track-artist" id="track-artist">‚Äî</div>
              <div class="track-playlist" id="track-playlist"></div>
            </div>
          </div>
        </div>
        <div class="spotify-controls">
          <button class="control-btn" onclick="togglePlayPause()" id="play-pause-btn">‚ñ∂</button>
          <button class="control-btn" onclick="skipSong()">‚è≠</button>
        </div>
      </div>

      <!-- Channel Stats -->
      <div class="section">
        <h2>Channel Stats</h2>
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; text-align: center;">
          <div>
            <div style="color: var(--muted); font-size: 14px; margin-bottom: 5px;">Followers</div>
            <div style="font-size: 48px; font-weight: 900; color: var(--purple);">
              <span id="follower-count">---</span>
            </div>
          </div>
          <div>
            <div style="color: var(--muted); font-size: 14px; margin-bottom: 5px;">Subscribers</div>
            <div style="font-size: 48px; font-weight: 900; color: var(--purple);">
              <span id="subscriber-count">---</span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Music Tab -->
  <div id="tab-music" class="tab-content">
    <!-- Pending Song Requests -->
    <div class="section">
      <h2>Pending Song Requests</h2>
      <div id="pending-queue"></div>
    </div>

    <!-- Quick Actions -->
    <div class="section">
      <h2>Quick Actions</h2>
      <button class="btn" style="margin-bottom: 10px;" onclick="skipSong()">Skip Current Song</button>
      <button class="btn" style="margin-bottom: 10px;" onclick="triggerPromo()">Trigger DCD Promo</button>
      <button class="btn" style="margin-bottom: 10px; background: #ff6b6b;" onclick="resetBot()">Reset Bot (Clear All Queues)</button>
    </div>
  </div>

  <!-- Overlays Tab -->
  <div id="tab-overlays" class="tab-content">
    <!-- Scoreboard -->
    <div class="section">
      <h2 style="display: flex; justify-content: space-between; align-items: center;">
        Scoreboard
        <button onclick="toggleScoreboardEdit()" style="background: none; border: none; color: var(--purple); cursor: pointer; font-size: 20px; padding: 5px;">‚úèÔ∏è</button>
      </h2>
      <div id="scoreboard-edit-section" class="hidden" style="margin-bottom: 15px;">
        <div style="margin-bottom: 15px;">
          <label style="display: block; margin-bottom: 8px; color: var(--text); font-weight: 600;">Player 1 Name</label>
          <input type="text" id="player1-name" placeholder="TATTOO" value="TATTOO" style="width: 100%; padding: 10px; background: rgba(139, 92, 246, 0.1); border: 1px solid rgba(139, 92, 246, 0.3); border-radius: 8px; color: var(--text); font-size: 14px;" />
        </div>
        <div style="margin-bottom: 15px;">
          <label style="display: block; margin-bottom: 8px; color: var(--text); font-weight: 600;">Player 2 Name</label>
          <input type="text" id="player2-name" placeholder="OPEN" value="OPEN" style="width: 100%; padding: 10px; background: rgba(139, 92, 246, 0.1); border: 1px solid rgba(139, 92, 246, 0.3); border-radius: 8px; color: var(--text); font-size: 14px;" />
        </div>
        <button class="btn" onclick="saveScoreboardNames()" style="width: 100%; background: #10b981;">Save Names</button>
      </div>
      <div class="scoreboard-controls">
        <div class="score-section">
          <label>Player 1 (TATTOO)</label>
          <div class="score-controls">
            <button class="score-btn" onclick="updateScore('player1', -1)">-</button>
            <div class="score-display" id="score1">0</div>
            <button class="score-btn" onclick="updateScore('player1', 1)">+</button>
          </div>
        </div>
        <div class="score-section">
          <label>Player 2 (OPEN)</label>
          <div class="score-controls">
            <button class="score-btn" onclick="updateScore('player2', -1)">-</button>
            <div class="score-display" id="score2">0</div>
            <button class="score-btn" onclick="updateScore('player2', 1)">+</button>
          </div>
        </div>
      </div>
      <button class="btn" style="margin-top: 15px;" onclick="resetScores()">Reset Scores</button>
    </div>

    <!-- Mode Display -->
    <div class="section">
      <h2 style="display: flex; justify-content: space-between; align-items: center;">
        Mode Display
        <button onclick="toggleModeDisplayVisibility()" id="mode-visibility-btn" style="background: none; border: none; color: var(--purple); cursor: pointer; font-size: 20px; padding: 5px;" title="Toggle Mode Display Visibility">üëÅÔ∏è</button>
      </h2>
      <div style="display: flex; flex-direction: column; gap: 10px; margin-bottom: 12px;">
        <div style="display: flex; gap: 10px;">
          <button class="btn" style="flex: 1;" onclick="setMode('tourney')">Tourney Play</button>
          <button class="btn" style="flex: 1;" onclick="setMode('lobby')">Open Lobby</button>
          <button class="btn" style="flex: 1;" onclick="setMode('cash')">Cash Sets</button>
        </div>
        <div style="display: flex; gap: 10px;">
          <button class="btn" style="flex: 1;" onclick="setMode('league')">League Play</button>
        </div>
        <div style="display: flex; align-items: center; gap: 8px;">
          <input type="checkbox" id="dubs-toggle" onchange="handleDubsToggle(this.checked)" />
          <label for="dubs-toggle" style="color: var(--text); font-weight: 600; cursor: pointer;">Enable Dubs Overlay</label>
        </div>
      </div>
      <div id="dubs-partner-container" style="margin-top: 12px; display: none;">
        <label style="display: block; margin-bottom: 6px; color: var(--text); font-weight: 600;">Dubs Partner Name</label>
        <input type="text" id="dubs-partner" placeholder="Partner Name" style="width: 100%; padding: 10px; background: rgba(139, 92, 246, 0.1); border: 1px solid rgba(139, 92, 246, 0.3); border-radius: 8px; color: var(--text); font-size: 14px;" />
        <small style="color: var(--muted); font-size: 12px;">Used when Dubs mode is active.</small>
        <button class="btn" style="margin-top: 10px;" onclick="saveDubsSettings()">Save Dubs Settings</button>
      </div>
      <div id="current-mode" style="text-align: center; margin-top: 10px; color: var(--muted); font-size: 14px;">
        Current: <span id="mode-text" style="color: var(--purple); font-weight: 600;">TOURNEY PLAY</span>
        <span id="mode-visibility-status" style="display: block; margin-top: 5px; font-size: 12px; color: var(--muted);"></span>
      </div>
    </div>

    <!-- BRB / Screen Control -->
    <div class="section">
      <h2>BRB / Screen Control</h2>
      <div style="display: flex; gap: 10px; margin-bottom: 10px;">
        <button class="btn" style="flex: 1;" onclick="activateBRB(5)">BRB 5min</button>
        <button class="btn" style="flex: 1;" onclick="activateBRB(10)">BRB 10min</button>
        <button class="btn" style="flex: 1;" onclick="activateBRB(15)">BRB 15min</button>
      </div>
      <button class="btn" style="margin-bottom: 10px; background: #6c757d;" onclick="deactivateScreen()">Dismiss Screen</button>
      <button class="btn" style="margin-bottom: 10px; background: var(--purple);" onclick="activateTechDifficulties()">Tech Difficulties</button>
    </div>
  </div>

  <!-- Settings Tab -->
  <div id="tab-settings" class="tab-content">
    <!-- Admin Management (Owner Only) -->
    <div id="admin-management" class="section hidden">
      <h2>Admin Management</h2>
      <div style="margin-bottom: 20px;">
        <h3 style="color: var(--purple); margin-bottom: 10px;">Add New Admin</h3>
        <input type="text" id="new-admin-name" placeholder="Admin Name" style="margin-bottom: 10px;" />
        <input type="text" id="new-admin-pin" placeholder="PIN (4+ digits)" style="margin-bottom: 10px;" />
        <div style="margin-bottom: 10px;">
          <label style="display: block; margin-bottom: 5px; color: var(--muted);">Theme Color</label>
          <input type="color" id="new-admin-color" value="#8b5cf6" style="width: 100%; height: 40px; border: none; border-radius: 8px; cursor: pointer;" />
        </div>
        <button class="btn" onclick="addAdmin()">Add Admin</button>
      </div>
      <div>
        <h3 style="color: var(--purple); margin-bottom: 10px;">Current Admins</h3>
        <div id="admin-list"></div>
      </div>
    </div>

    <!-- Bot Settings -->
    <div class="section">
      <h2>Bot Settings</h2>

      <div style="margin-bottom: 20px;">
        <label style="display: block; margin-bottom: 8px; color: var(--text); font-weight: 600;">Special Users</label>
        <div id="special-users-list" style="margin-bottom: 10px;"></div>
        <div style="display: flex; gap: 8px;">
          <input type="text" id="new-special-user" placeholder="Username" style="flex: 1; padding: 10px; background: rgba(139, 92, 246, 0.1); border: 1px solid rgba(139, 92, 246, 0.3); border-radius: 8px; color: var(--text); font-size: 14px;" />
          <button class="btn" onclick="addSpecialUser()" style="padding: 10px 20px;">Add</button>
        </div>
      </div>

      <div style="margin-bottom: 20px;">
        <label style="display: block; margin-bottom: 8px; color: var(--text); font-weight: 600;">Promo Interval (minutes)</label>
        <input type="number" id="promo-minutes" min="1" max="60" value="15" style="width: 100%; padding: 10px; background: rgba(139, 92, 246, 0.1); border: 1px solid rgba(139, 92, 246, 0.3); border-radius: 8px; color: var(--text); font-size: 14px;" onchange="updatePromoInterval()" />
      </div>

      <div style="margin-bottom: 20px;">
        <label style="display: block; margin-bottom: 8px; color: var(--text); font-weight: 600;">PWA Background URL</label>
        <input type="text" id="pwa-background-url" placeholder="images/background.png" value="images/background.png" style="width: 100%; padding: 10px; background: rgba(139, 92, 246, 0.1); border: 1px solid rgba(139, 92, 246, 0.3); border-radius: 8px; color: var(--text); font-size: 14px;" />
        <small style="color: var(--muted); font-size: 12px; margin-top: 4px; display: block;">Relative path or full URL</small>
      </div>

      <div style="margin-bottom: 20px;">
        <label style="display: block; margin-bottom: 8px; color: var(--text); font-weight: 600;">OBS Overlays Background URL</label>
        <input type="text" id="obs-background-url" placeholder="Leave empty for transparent" value="" style="width: 100%; padding: 10px; background: rgba(139, 92, 246, 0.1); border: 1px solid rgba(139, 92, 246, 0.3); border-radius: 8px; color: var(--text); font-size: 14px;" />
        <small style="color: var(--muted); font-size: 12px; margin-top: 4px; display: block;">Relative path or full URL (leave empty for transparent)</small>
      </div>

      <button class="btn" onclick="saveSettings()" style="width: 100%; background: #8400ff;">Save All Settings</button>
    </div>

    <!-- Logout -->
    <button class="btn logout-btn" onclick="logout()">Logout</button>
  </div>

  <!-- Help Tab -->
  <div id="tab-help" class="tab-content">
    <div class="section">
      <h2>Available Commands</h2>
      <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; font-size: 14px;">
        <div><strong>!sr [song]</strong> - Request a song</div>
        <div><strong>!queue</strong> - View current queue</div>
        <div><strong>!cancel</strong> - Cancel your request</div>
        <div><strong>!lastseen [user]</strong> - Check last activity</div>
        <div><strong>!lurkers</strong> - Show anonymous viewers</div>
        <div><strong>!dcd</strong> - Dead Center Darts promo</div>
        <div><strong>!prime</strong> - Prime sub promo</div>
        <div><strong>!llogb</strong> - Join our Facebook group!<br>facebook.com/groups/thelowlifesofgranboard</div>
        <div><strong>!waitlist</strong> - Join our waitlist!<br>www.lowlifesofgranboard.com/launch</div>
        <div style="color: var(--purple);"><strong>!approve [id]</strong> - Mod only</div>
        <div style="color: var(--purple);"><strong>!deny [id]</strong> - Mod only</div>
        <div style="color: var(--purple);"><strong>!skip</strong> - Mod only</div>
      </div>
    </div>
  </div>
</div>

<script type="module" src="js/app.js?v=8"></script>

</body>
</html>
