<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Channel Points Alert</title>
<style>
  * {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
  }

  html, body {
    width: 100vw;
    height: 100vh;
    background: transparent;
    overflow: hidden;
    position: relative;
  }

  .coin-alert {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    opacity: 0;
    pointer-events: none;
  }

  .coin-container {
    width: 320px;
    height: 320px;
    position: relative;
    perspective: 1000px;
  }

  /* Spring up and spin animation */
  @keyframes coinEntrance {
    0% {
      transform: translate(-50%, 100vh) scale(0.5) rotateY(0deg);
      opacity: 0;
    }
    30% {
      opacity: 1;
    }
    50% {
      transform: translate(-50%, -60%) scale(1.1) rotateY(540deg);
    }
    70% {
      transform: translate(-50%, -48%) scale(0.95) rotateY(900deg);
    }
    85% {
      transform: translate(-50%, -52%) scale(1.02) rotateY(1080deg);
    }
    100% {
      transform: translate(-50%, -50%) scale(1) rotateY(1080deg);
      opacity: 1;
    }
  }

  @keyframes fadeOut {
    0% {
      opacity: 1;
      transform: translate(-50%, -50%) scale(1);
    }
    100% {
      opacity: 0;
      transform: translate(-50%, -50%) scale(0.8);
    }
  }

  .coin-alert.active {
    animation: coinEntrance 1.5s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
    opacity: 1;
  }

  .coin-alert.exit {
    animation: fadeOut 0.5s ease-out forwards;
  }

  /* Redemption text */
  .redemption-text {
    position: absolute;
    bottom: -50px;
    left: 50%;
    transform: translateX(-50%);
    text-align: center;
    opacity: 0;
    animation: textFadeIn 0.5s ease-out 1s forwards;
  }

  @keyframes textFadeIn {
    0% {
      opacity: 0;
      transform: translateX(-50%) translateY(20px);
    }
    100% {
      opacity: 1;
      transform: translateX(-50%) translateY(0);
    }
  }

  .redemption-user {
    font-size: 36px;
    font-weight: 900;
    color: #8A38F5;
    text-shadow:
      -2px -2px 0 #000,
      2px -2px 0 #000,
      -2px 2px 0 #000,
      2px 2px 0 #000,
      0 0 20px #8A38F5,
      0 0 40px #8A38F5;
    margin-bottom: 10px;
    font-family: system-ui, -apple-system, sans-serif;
  }

  .redemption-reward {
    font-size: 26px;
    font-weight: 700;
    color: #ffffff;
    text-shadow:
      -2px -2px 0 #000,
      2px -2px 0 #000,
      -2px 2px 0 #000,
      2px 2px 0 #000;
    font-family: system-ui, -apple-system, sans-serif;
  }
</style>
</head>
<body>
  <div class="coin-alert" id="coin-alert">
    <div class="coin-container">
      <!-- Purple Skull Coin SVG -->
      <svg viewBox="0 0 496 496" fill="none" xmlns="http://www.w3.org/2000/svg" style="width: 100%; height: 100%;">
        <defs>
          <radialGradient id="coinGradient" cx="50%" cy="35%" r="70%">
            <stop offset="0%" stop-color="#C78AFE"/>
            <stop offset="45%" stop-color="#9D4EF9"/>
            <stop offset="100%" stop-color="#681FCC"/>
          </radialGradient>

          <radialGradient id="rimGradient" cx="30%" cy="30%" r="80%">
            <stop offset="0%" stop-color="#BB8CFF" stop-opacity="0.95"/>
            <stop offset="100%" stop-color="#510FB2"/>
          </radialGradient>

          <filter id="coinShadow" x="-40%" y="-40%" width="180%" height="180%">
            <feDropShadow dx="0" dy="20" stdDeviation="25" flood-color="#2C0F52" flood-opacity="0.6"/>
          </filter>
        </defs>

        <!-- Coin base -->
        <circle cx="248" cy="248" r="240" fill="url(#rimGradient)" filter="url(#coinShadow)"/>
        <circle cx="248" cy="248" r="200" fill="url(#coinGradient)" stroke="#34145C" stroke-width="10"/>
        <circle cx="248" cy="248" r="178" fill="url(#coinGradient)" opacity="0.65"/>

        <!-- Skull -->
        <path d="M248 126c-68 0-118 45-118 110 0 60 40 101 74 113v30c0 17 13 30 30 30h14c10 0 18-8 18-18v-10h12v10c0 10 8 18 18 18h14c17 0 30-13 30-30v-30c34-12 74-53 74-113 0-65-50-110-118-110z"
              fill="#C7A5FF" stroke="#2B0C4A" stroke-width="12" stroke-linejoin="round"/>
        <circle cx="204" cy="238" r="42" fill="#2B0C4A"/>
        <circle cx="292" cy="238" r="42" fill="#2B0C4A"/>
        <path d="M236 300h24l10 40c2 7-3 14-10 14h-24c-7 0-12-7-10-14l10-40z"
              fill="#2B0C4A"/>
        <path d="M216 328h64" stroke="#C7A5FF" stroke-width="10" stroke-linecap="round"/>

        <!-- Highlights -->
        <ellipse cx="340" cy="120" rx="34" ry="18" fill="#fff" opacity="0.45" transform="rotate(-22 340 120)"/>
        <ellipse cx="380" cy="160" rx="20" ry="10" fill="#fff" opacity="0.25" transform="rotate(-30 380 160)"/>
      </svg>
    </div>

    <div class="redemption-text">
      <div class="redemption-user" id="redemption-user"></div>
      <div class="redemption-reward" id="redemption-reward"></div>
    </div>
  </div>

  <script>
    const RENDER_URL = 'https://tattoostwitch327.onrender.com';

    // Listen for channel points events
    const cpEventSource = new EventSource(RENDER_URL + '/channel-points-events');
    cpEventSource.onmessage = (event) => {
      try {
        const data = JSON.parse(event.data);
        console.log('[CP] Received channel points event:', data);
        triggerChannelPointsAlert(data.username, data.reward);
      } catch (e) {
        console.error('[CP] Failed to parse event:', e);
      }
    };

    function triggerChannelPointsAlert(username, rewardName) {
      const alert = document.getElementById('coin-alert');
      const userEl = document.getElementById('redemption-user');
      const rewardEl = document.getElementById('redemption-reward');

      userEl.textContent = username;
      rewardEl.textContent = rewardName;

      alert.classList.remove('exit');
      alert.classList.add('active');

      // Remove after 4 seconds
      setTimeout(() => {
        alert.classList.remove('active');
        alert.classList.add('exit');

        setTimeout(() => {
          alert.classList.remove('exit');
        }, 500);
      }, 4000);
    }

    // Test function (can be called from console)
    window.testChannelPoints = (username = 'TestUser', reward = 'Hydrate Reminder') => {
      triggerChannelPointsAlert(username, reward);
    };

    console.log('[CHANNEL POINTS] Listening for redemptions...');
    console.log('[CHANNEL POINTS] Test with: testChannelPoints("Username", "Reward Name")');
  </script>
</body>
</html>
